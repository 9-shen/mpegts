<!DOCTYPE html>
<html>
<head>
    <title>MPEG-TS Parser demo</title>
    <script src="/jDataView/src/jdataview.js"></script>
    <script src="/jBinary/src/jbinary.js"></script>
    <script src="mp4.js"></script>
    <style type="text/css">
        #jsonContainer { color: #733; font-style: italic; word-wrap: break-word; }
        .jsonValue { color: #373; font-weight: bold; font-style: normal; }
    </style>
</head>
<body>
    <pre id="jsonContainer">
    </pre>
    <video id="video"></video>
    <script>
        var mpegts = MP4.readFrom('sample.mp4', function () {
            document.getElementById('jsonContainer').innerHTML = // PES
                JSON.stringify(
                    [this.readBox(), this.readBox(), this.readBox(), this.readBox()],
                    function (key, value) {
                        if (key[0] === '_') return undefined;

                        if (value instanceof Array && value.length > 250 && (typeof value[0] === 'number')) {
                            value = value.map(function (value) {
                                var str = value.toString(16).toUpperCase();
                                return str.length == 2 ? str : '0' + str;
                            }).join(' ');
                        }

                        return value instanceof Object ? value : '<span class=jsonValue>' + value + '</span>';
                    },
                    '    '
                );

            var source = document.createElement('source');
            source.type = 'video/mp4';
            source.src = this.parser.toURL(source.type);
            document.getElementById('video').appendChild(source);
        });
    </script>
</body>
</html>
